   1               		.file	"dac.c"
   2               	__SREG__ = 0x3f
   3               	__SP_H__ = 0x3e
   4               	__SP_L__ = 0x3d
   5               	__CCP__ = 0x34
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   9               		.text
  10               	.Ltext0:
  70               		.section	.text.dac_begin,"ax",@progbits
  72               	.global	dac_begin
  74               	dac_begin:
   1:dac.c         **** #include <avr/io.h>
   2:dac.c         **** #include "flash.h"
   3:dac.c         **** #include "dac.h"
   4:dac.c         **** 
   5:dac.c         **** /* protocol:
   6:dac.c         **** 
   7:dac.c         ****    [A3, A2, A1, A0, C1, C0, D9, D8, ... , D0]
   8:dac.c         **** 
   9:dac.c         ****    [A3:A0] register address
  10:dac.c         ****    [C1:C0] 11 = read, 00 = write, 01 = increment (8bit), 10 = decrement (8bit)
  11:dac.c         **** 
  12:dac.c         ****    data in D9 are ignored, since internal registers are only 9bit wide
  13:dac.c         ****    8 bit commands use only D9, D8
  14:dac.c         **** 
  15:dac.c         ****    device response contains CMDERR bit in D8 (1 = OK, 0 = error)
  16:dac.c         **** */
  17:dac.c         **** 
  18:dac.c         **** /* MCP4XXX register addresses */
  19:dac.c         **** #define DAC_AUDIO 0x00
  20:dac.c         **** #define DAC_VOLUME 0x01
  21:dac.c         **** #define DAC_TCON 0x04
  22:dac.c         **** #define DAC_STATUS 0x05
  23:dac.c         **** 
  24:dac.c         **** /* MCP4XXX commands */
  25:dac.c         **** #define DAC_WRITE 0b00
  26:dac.c         **** #define DAC_READ 0b11
  27:dac.c         **** #define DAC_INC 0b01
  28:dac.c         **** #define DAC_DEC 0b10
  29:dac.c         **** 
  30:dac.c         **** /* volume status */
  31:dac.c         **** struct{
  32:dac.c         ****     uint8_t level:8;
  33:dac.c         ****     uint8_t changed:1;
  34:dac.c         ****     uint8_t mute:1;
  35:dac.c         **** } volume;
  36:dac.c         **** 
  37:dac.c         **** 
  38:dac.c         **** void dac_begin()
  39:dac.c         **** {
  76               	.LM0:
  77               	.LFBB1:
  78               	/* prologue: function */
  79               	/* frame size = 0 */
  80               	/* stack size = 0 */
  81               	.L__stack_usage = 0
  40:dac.c         ****     flash_pause();
  83               	.LM1:
  84 0000 00D0      		rcall flash_pause
  41:dac.c         ****     DAC_PORT &= ~_BV(DAC_CS);
  86               	.LM2:
  87 0002 D898      		cbi 59-32,0
  88               	/* epilogue start */
  42:dac.c         **** }
  90               	.LM3:
  91 0004 0895      		ret
  93               	.Lscope1:
  94               		.section	.text.dac_end,"ax",@progbits
  96               	.global	dac_end
  98               	dac_end:
  43:dac.c         **** 
  44:dac.c         **** 
  45:dac.c         **** void dac_end()
  46:dac.c         **** {
 100               	.LM4:
 101               	.LFBB2:
 102               	/* prologue: function */
 103               	/* frame size = 0 */
 104               	/* stack size = 0 */
 105               	.L__stack_usage = 0
  47:dac.c         ****     DAC_PORT |= _BV(DAC_CS);
 107               	.LM5:
 108 0000 D89A      		sbi 59-32,0
  48:dac.c         ****     flash_unpause();
 110               	.LM6:
 111 0002 00D0      		rcall flash_unpause
 112               	/* epilogue start */
  49:dac.c         **** }
 114               	.LM7:
 115 0004 0895      		ret
 117               	.Lscope2:
 118               		.section	.text.dac_volume,"ax",@progbits
 121               	.global	dac_volume
 123               	dac_volume:
  50:dac.c         **** 
  51:dac.c         **** void dac_volume(uint8_t vol)
  52:dac.c         **** {
 125               	.LM8:
 126               	.LFBB3:
 127               	/* prologue: function */
 128               	/* frame size = 0 */
 129               	/* stack size = 0 */
 130               	.L__stack_usage = 0
  53:dac.c         ****     volume.level = vol;
 132               	.LM9:
 133 0000 8093 0000 		sts volume,r24
  54:dac.c         ****     volume.changed = 1;
 135               	.LM10:
 136 0004 8091 0000 		lds r24,volume+1
 137 0008 8160      		ori r24,lo8(1)
 138 000a 8093 0000 		sts volume+1,r24
 139               	/* epilogue start */
  55:dac.c         **** }
 141               	.LM11:
 142 000e 0895      		ret
 144               	.Lscope3:
 145               		.section	.text.dac_output,"ax",@progbits
 148               	.global	dac_output
 150               	dac_output:
  56:dac.c         **** 
  57:dac.c         **** void dac_output(uint8_t value)
  58:dac.c         **** {
 152               	.LM12:
 153               	.LFBB4:
 154               	/* prologue: function */
 155               	/* frame size = 0 */
 156               	/* stack size = 0 */
 157               	.L__stack_usage = 0
  59:dac.c         ****     uint8_t i;
  60:dac.c         **** 
  61:dac.c         ****     /* output the command byte for audio value */
  62:dac.c         ****     USIDR = (DAC_AUDIO << 4) | (DAC_WRITE << 2);
 159               	.LM13:
 160 0000 1FB8      		out 47-32,__zero_reg__
 161 0002 98E0      		ldi r25,lo8(8)
 162               	.L5:
  63:dac.c         ****     for(i = 0; i < 8; i++) {
  64:dac.c         ****         USICR |= _BV(USITC);
 164               	.LM14:
 165 0004 689A      		sbi 45-32,0
  65:dac.c         ****         USICR |= _BV(USITC) | _BV(USICLK);
 167               	.LM15:
 168 0006 2DB1      		in r18,45-32
 169 0008 2360      		ori r18,lo8(3)
 170 000a 2DB9      		out 45-32,r18
 171 000c 9150      		subi r25,lo8(-(-1))
  63:dac.c         ****     for(i = 0; i < 8; i++) {
 173               	.LM16:
 174 000e 01F4      		brne .L5
  66:dac.c         ****     }
  67:dac.c         **** 
  68:dac.c         ****     /* output the data byte for audio value */
  69:dac.c         ****     USIDR = value;
 176               	.LM17:
 177 0010 8FB9      		out 47-32,r24
 178 0012 88E0      		ldi r24,lo8(8)
 179               	.L6:
  70:dac.c         ****     for(i = 0; i < 8; i++) {
  71:dac.c         ****         USICR |= _BV(USITC);
 181               	.LM18:
 182 0014 689A      		sbi 45-32,0
  72:dac.c         ****         USICR |= _BV(USITC) | _BV(USICLK);
 184               	.LM19:
 185 0016 9DB1      		in r25,45-32
 186 0018 9360      		ori r25,lo8(3)
 187 001a 9DB9      		out 45-32,r25
 188 001c 8150      		subi r24,lo8(-(-1))
  70:dac.c         ****     for(i = 0; i < 8; i++) {
 190               	.LM20:
 191 001e 01F4      		brne .L6
  73:dac.c         ****     }
  74:dac.c         **** 
  75:dac.c         **** 
  76:dac.c         ****     if (!volume.changed) return;
 193               	.LM21:
 194 0020 8091 0000 		lds r24,volume+1
 195 0024 80FF      		sbrs r24,0
 196 0026 00C0      		rjmp .L4
  77:dac.c         **** 
  78:dac.c         ****     /* output the command byte for volume value */
  79:dac.c         ****     USIDR = (DAC_VOLUME << 4) | (DAC_WRITE << 2);
 198               	.LM22:
 199 0028 80E1      		ldi r24,lo8(16)
 200 002a 8FB9      		out 47-32,r24
 201 002c 88E0      		ldi r24,lo8(8)
 202               	.L8:
  80:dac.c         ****     for(i = 0; i < 8; i++) {
  81:dac.c         ****         USICR |= _BV(USITC);
 204               	.LM23:
 205 002e 689A      		sbi 45-32,0
  82:dac.c         ****         USICR |= _BV(USITC) | _BV(USICLK);
 207               	.LM24:
 208 0030 9DB1      		in r25,45-32
 209 0032 9360      		ori r25,lo8(3)
 210 0034 9DB9      		out 45-32,r25
 211 0036 8150      		subi r24,lo8(-(-1))
  80:dac.c         ****     for(i = 0; i < 8; i++) {
 213               	.LM25:
 214 0038 01F4      		brne .L8
  83:dac.c         ****     }
  84:dac.c         **** 
  85:dac.c         **** 
  86:dac.c         ****     /* output the data byte for volume value */
  87:dac.c         ****     USIDR = volume.mute ? 0 : volume.level;
 216               	.LM26:
 217 003a 8091 0000 		lds r24,volume+1
 218 003e 81FD      		sbrc r24,1
 219 0040 00C0      		rjmp .L11
 221               	.LM27:
 222 0042 8091 0000 		lds r24,volume
 223 0046 00C0      		rjmp .L9
 224               	.L11:
 226               	.LM28:
 227 0048 80E0      		ldi r24,lo8(0)
 228               	.L9:
 230               	.LM29:
 231 004a 8FB9      		out 47-32,r24
 232 004c 88E0      		ldi r24,lo8(8)
 233               	.L10:
  88:dac.c         ****     for(i = 0; i < 8; i++) {
  89:dac.c         ****         USICR |= _BV(USITC);
 235               	.LM30:
 236 004e 689A      		sbi 45-32,0
  90:dac.c         ****         USICR |= _BV(USITC) | _BV(USICLK);
 238               	.LM31:
 239 0050 9DB1      		in r25,45-32
 240 0052 9360      		ori r25,lo8(3)
 241 0054 9DB9      		out 45-32,r25
 242 0056 8150      		subi r24,lo8(-(-1))
  88:dac.c         ****     for(i = 0; i < 8; i++) {
 244               	.LM32:
 245 0058 01F4      		brne .L10
  91:dac.c         ****     }
  92:dac.c         **** 
  93:dac.c         ****     volume.changed = 0;
 247               	.LM33:
 248 005a 8091 0000 		lds r24,volume+1
 249 005e 8E7F      		andi r24,lo8(-2)
 250 0060 8093 0000 		sts volume+1,r24
 251               	.L4:
 252 0064 0895      		ret
 254               	.Lscope4:
 255               		.section	.text.dac_mute,"ax",@progbits
 257               	.global	dac_mute
 259               	dac_mute:
  94:dac.c         **** }
  95:dac.c         **** 
  96:dac.c         **** void dac_init()
  97:dac.c         **** {
  98:dac.c         ****     DAC_DDR |= _BV(DAC_CS);
  99:dac.c         ****     DAC_PORT |= _BV(DAC_CS);
 100:dac.c         **** 
 101:dac.c         ****     /* full output, middle level */
 102:dac.c         ****     dac_volume(255);
 103:dac.c         ****     dac_unmute();
 104:dac.c         ****     dac_begin();
 105:dac.c         ****     dac_output(128);
 106:dac.c         ****     dac_end();
 107:dac.c         **** }
 108:dac.c         **** 
 109:dac.c         **** void dac_mute()
 110:dac.c         **** {
 261               	.LM34:
 262               	.LFBB5:
 263               	/* prologue: function */
 264               	/* frame size = 0 */
 265               	/* stack size = 0 */
 266               	.L__stack_usage = 0
 111:dac.c         ****     volume.mute = 1;
 268               	.LM35:
 269 0000 8091 0000 		lds r24,volume+1
 112:dac.c         ****     volume.changed = 1;
 271               	.LM36:
 272 0004 8360      		ori r24,lo8(3)
 273 0006 8093 0000 		sts volume+1,r24
 274               	/* epilogue start */
 113:dac.c         **** }
 276               	.LM37:
 277 000a 0895      		ret
 279               	.Lscope5:
 280               		.section	.text.dac_unmute,"ax",@progbits
 282               	.global	dac_unmute
 284               	dac_unmute:
 114:dac.c         **** 
 115:dac.c         **** void dac_unmute()
 116:dac.c         **** {
 286               	.LM38:
 287               	.LFBB6:
 288               	/* prologue: function */
 289               	/* frame size = 0 */
 290               	/* stack size = 0 */
 291               	.L__stack_usage = 0
 117:dac.c         ****     volume.mute = 0;
 293               	.LM39:
 294 0000 8091 0000 		lds r24,volume+1
 295 0004 8D7F      		andi r24,lo8(-3)
 118:dac.c         ****     volume.changed = 1;
 297               	.LM40:
 298 0006 8160      		ori r24,lo8(1)
 299 0008 8093 0000 		sts volume+1,r24
 300               	/* epilogue start */
 119:dac.c         **** }
 302               	.LM41:
 303 000c 0895      		ret
 305               	.Lscope6:
 306               		.section	.text.dac_init,"ax",@progbits
 308               	.global	dac_init
 310               	dac_init:
  97:dac.c         **** {
 312               	.LM42:
 313               	.LFBB7:
 314               	/* prologue: function */
 315               	/* frame size = 0 */
 316               	/* stack size = 0 */
 317               	.L__stack_usage = 0
  98:dac.c         ****     DAC_DDR |= _BV(DAC_CS);
 319               	.LM43:
 320 0000 D09A      		sbi 58-32,0
  99:dac.c         ****     DAC_PORT |= _BV(DAC_CS);
 322               	.LM44:
 323 0002 D89A      		sbi 59-32,0
 324               	.LBB4:
 325               	.LBB5:
  53:dac.c         ****     volume.level = vol;
 327               	.LM45:
 328 0004 8FEF      		ldi r24,lo8(-1)
 329 0006 8093 0000 		sts volume,r24
  54:dac.c         ****     volume.changed = 1;
 331               	.LM46:
 332 000a 8091 0000 		lds r24,volume+1
 333 000e 8160      		ori r24,lo8(1)
 334 0010 8093 0000 		sts volume+1,r24
 335               	.LBE5:
 336               	.LBE4:
 103:dac.c         ****     dac_unmute();
 338               	.LM47:
 339 0014 00D0      		rcall dac_unmute
 104:dac.c         ****     dac_begin();
 341               	.LM48:
 342 0016 00D0      		rcall dac_begin
 105:dac.c         ****     dac_output(128);
 344               	.LM49:
 345 0018 80E8      		ldi r24,lo8(-128)
 346 001a 00D0      		rcall dac_output
 106:dac.c         ****     dac_end();
 348               	.LM50:
 349 001c 00D0      		rcall dac_end
 350               	/* epilogue start */
 107:dac.c         **** }
 352               	.LM51:
 353 001e 0895      		ret
 355               	.Lscope7:
 356               		.comm volume,2,1
 358               		.text
 360               	.Letext0:
 361               	.global __do_clear_bss
DEFINED SYMBOLS
                            *ABS*:00000000 dac.c
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:2      *ABS*:0000003f __SREG__
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:3      *ABS*:0000003e __SP_H__
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:4      *ABS*:0000003d __SP_L__
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:5      *ABS*:00000034 __CCP__
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:6      *ABS*:00000000 __tmp_reg__
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:7      *ABS*:00000001 __zero_reg__
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:74     .text.dac_begin:00000000 dac_begin
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:98     .text.dac_end:00000000 dac_end
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:123    .text.dac_volume:00000000 dac_volume
                            *COM*:00000002 volume
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:150    .text.dac_output:00000000 dac_output
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:259    .text.dac_mute:00000000 dac_mute
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:284    .text.dac_unmute:00000000 dac_unmute
/var/folders/4j/4jnX1ciVFyqgR-SAAt4fNE+++TI/-Tmp-//ccq7YpnW.s:310    .text.dac_init:00000000 dac_init

UNDEFINED SYMBOLS
flash_pause
flash_unpause
__do_clear_bss
